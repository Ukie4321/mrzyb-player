<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
<link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet" />
<title>MRZYB Player Universal</title>
<style>
.play-btn {
  box-shadow: 0 0 15px rgba(20,42,197,0.8);
  animation: pulse 1.5s infinite;
}
@keyframes pulse {
  0% { transform: scale(1); box-shadow: 0 0 10px rgba(20,42,197,0.6); }
  50% { transform: scale(1.15); box-shadow: 0 0 25px rgba(20,42,197,1); }
  100% { transform: scale(1); box-shadow: 0 0 10px rgba(20,42,197,0.6); }
}
.col img{width:100%;border-radius:5px;margin-bottom:5px}
.bg-fondo{display:flex;align-items:flex-end;padding:10px;padding-top:150px;position:relative;background:rgba(0,0,0,.7)}
.bg-fondo h4{font-weight:500}
.bg-fondo::before{content:'';position:absolute;top:0;left:0;width:100%;height:100%;background:url(https://image.tmdb.org/t/p/original/8yPSYhooj8nyBbmV3GVdLDwuE7e.jpg) no-repeat center center / cover;z-index:-1;opacity:.8}
.modal{margin:50px auto; max-width:90%;}
#modal2 .modal-content { padding: 0; }
#modal2 video { width: 100% !important; height: auto !important; max-height: 80vh; border-radius: 5px; }
.iframe-container{position:relative;overflow:hidden;width:100%;padding-top:36.25%}
.responsive-iframe{position:absolute;top:0;left:0;bottom:0;right:0;width:100%;height:100%}
#countdown { margin-top:10px; font-weight:bold; color:#ff9800; }
</style>
</head>
<body class="grey darken-4" style="background-color: #000 !important;">

<!-- Tombol Play di atas poster dengan efek glow -->
<div style="position:absolute; top:20px; right:20px; z-index:1000;">
  <a href="#modal2" class="btn-floating btn-large blue modal-trigger play-btn" style="background-color:#142ac5 !important;">
    <i class="large material-icons">play_arrow</i>
  </a>
</div>

<div class="row bg-fondo">
  <div class="col s3 m4 l2">
    <img id="poster" src="https://image.tmdb.org/t/p/w500/2EH42blLQzgqwDWxn39RXkTgb91.jpg" alt="poster">
  </div>
  <div class="col s9 m8 l10">
    <h4 class="white-text" id="title">Romper el c√≠rculo - (2024)</h4>
    <div id="countdown"></div>
  </div>
</div>

<!-- PLAYER -->
<div id="modal2" class="modal grey darken-4">
  <div class="modal-content white-text">
    <video id="player" class="video-js vjs-big-play-centered" controls preload="auto"></video>
  </div>
  <div class="modal-footer grey darken-4">
    <a href="#!" class="modal-close waves-effect waves-green btn-flat white-text">Cerrar video</a>
  </div>
</div>

<!-- GENERATOR -->
<div class="container white-text" style="margin-top:30px;">
  <h5>üîó Generator Link</h5>
  <p class="grey-text">Masukkan <b>judul</b>, <b>poster</b>, dan <b>link Worker / Drive Index</b>.</p>

  <input type="text" id="inputTitle" class="white-text" placeholder="Judul Film" style="background:#222;padding:10px;border-radius:5px;width:100%;margin-bottom:10px;">
  <input type="text" id="inputPoster" class="white-text" placeholder="URL Poster" style="background:#222;padding:10px;border-radius:5px;width:100%;margin-bottom:10px;">
  <input type="text" id="inputLink" class="white-text" placeholder="https://namaworker.workers.dev/?file=video.mp4" style="background:#222;padding:10px;border-radius:5px;width:100%;margin-bottom:10px;">

  <button class="btn blue" onclick="makeShareLink()">Buat Link</button>
  <div id="shareResult" style="margin-top:15px;"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
<script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
<script>
M.AutoInit();

function loadMovie(data){
  if(data.title) document.getElementById("title").innerText = data.title;
  if(data.poster) document.getElementById("poster").src = data.poster;

  if(data.video){
    const player = videojs("player");
    player.src({ src: data.video, type: "video/mp4" });

    // deteksi error expired
    player.on("error", function() {
      const err = player.error();
      if (err && err.code === 4) {
        showExpiredMessage();
      }
    });
  }
}

// Countdown ke jam 12 siang
function startCountdown() {
  function updateCountdown() {
    const now = new Date();
    const expiry = new Date();
    expiry.setHours(12, 0, 0, 0); // jam 12 siang

    // kalau sudah lewat 12 siang hari ini, pakai besok
    if (now > expiry) {
      expiry.setDate(expiry.getDate() + 1);
    }

    const diff = expiry - now;
    const hours = Math.floor(diff / (1000 * 60 * 60));
    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((diff % (1000 * 60)) / 1000);

    if (diff <= 0) {
      showExpiredMessage();
    } else {
      const tanggal = expiry.toLocaleDateString('id-ID');
      const jam = expiry.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
      document.getElementById("countdown").innerText = `‚è≥ Link akan expired dalam ${hours}j ${minutes}m ${seconds}d | Expired: ${tanggal} ${jam} WIB`;
    }
  }

  updateCountdown();
  setInterval(updateCountdown, 1000);
}

function showExpiredMessage() {
  document.getElementById("modal2").innerHTML = `
    <div class="modal-content white-text center-align" style="padding:40px;">
      <h4>‚ö†Ô∏è Link sudah kadaluarsa</h4>
      <p>Silakan gabung group Telegram untuk mendapatkan link baru:</p>
      <a href="https://t.me/mrzyb_movie" target="_blank" class="btn blue">Gabung Group</a>
    </div>
  `;
  document.getElementById("countdown").innerText = "‚ö†Ô∏è Link sudah kadaluarsa";
}

window.addEventListener("DOMContentLoaded", () => {
  const params = new URLSearchParams(window.location.search);
  const encoded = params.get("data");
  if(encoded){
    try {
      const decoded = atob(encoded);
      const obj = JSON.parse(decoded);
      loadMovie(obj);
    } catch(e) {
      console.error("Link tidak valid!", e);
    }
  } else {
    loadMovie({
      title: "Romper el c√≠rculo - (2024)",
      poster: "https://image.tmdb.org/t/p/w500/2EH42blLQzgqwDWxn39RXkTgb91.jpg",
      video: "https://filmmrzyb.ukielaki8387.workers.dev/download.aspx?file=contoh.mp4"
    });
  }
  startCountdown();
});

function makeShareLink() {
  const title = document.getElementById("inputTitle").value.trim();
  const poster = document.getElementById("inputPoster").value.trim();
  const video = document.getElementById("inputLink").value.trim();

  if(!video){
    document.getElementById("shareResult").innerHTML = "<p class='red-text'>‚ö†Ô∏è Masukkan link!</p>";
    return;
  }

  try {
    const data = { title, poster, video };
    const encoded = btoa(JSON.stringify(data));
    const finalUrl = window.location.origin + window.location.pathname + "?data=" + encoded;

    loadMovie(data);

    document.getElementById("shareResult").innerHTML = `
      <p>‚úÖ Link siap copy:</p>
      <input type="text" value="${finalUrl}" readonly style="background:#111;color:#0f0;padding:8px;width:100%;border:none;border-radius:5px;" onclick="this.select()">
    `;
  } catch(e){
    document.getElementById("shareResult").innerHTML = "<p class='red-text'>‚ö†Ô∏è Data tidak valid!</p>";
  }
}
</script>
</body>
</html>
